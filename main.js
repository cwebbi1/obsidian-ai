/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var L=Object.defineProperty;var ot=Object.getOwnPropertyDescriptor;var at=Object.getOwnPropertyNames;var rt=Object.prototype.hasOwnProperty;var ct=(t,n)=>{for(var e in n)L(t,e,{get:n[e],enumerable:!0})},lt=(t,n,e,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of at(n))!rt.call(t,i)&&i!==e&&L(t,i,{get:()=>n[i],enumerable:!(s=ot(n,i))||s.enumerable});return t};var dt=t=>lt(L({},"__esModule",{value:!0}),t);var kt={};ct(kt,{default:()=>D});module.exports=dt(kt);var f=require("obsidian");var K;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(K||(K={}));var $;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})($||($={}));var B;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(B||(B={}));var Y=["user","model","function","system"],p;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(p||(p={}));var I;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(I||(I={}));var P;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(P||(P={}));var j;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(j||(j={}));var R;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(R||(R={}));var V;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(V||(V={}));var q;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(q||(q={}));var J;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(J||(J={}));var u=class extends Error{constructor(n){super(`[GoogleGenerativeAI Error]: ${n}`)}},C=class extends u{constructor(n,e){super(n),this.response=e}},N=class extends u{constructor(n,e,s,i){super(n),this.status=e,this.statusText=s,this.errorDetails=i}},E=class extends u{},b=class extends u{};var ut="https://generativelanguage.googleapis.com",ft="v1beta",ht="0.24.0",gt="genai-js",m;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(m||(m={}));var G=class{constructor(n,e,s,i,o){this.model=n,this.task=e,this.apiKey=s,this.stream=i,this.requestOptions=o}toString(){var n,e;let s=((n=this.requestOptions)===null||n===void 0?void 0:n.apiVersion)||ft,o=`${((e=this.requestOptions)===null||e===void 0?void 0:e.baseUrl)||ut}/${s}/${this.model}:${this.task}`;return this.stream&&(o+="?alt=sse"),o}};function Et(t){let n=[];return t!=null&&t.apiClient&&n.push(t.apiClient),n.push(`${gt}/${ht}`),n.join(" ")}async function Ct(t){var n;let e=new Headers;e.append("Content-Type","application/json"),e.append("x-goog-api-client",Et(t.requestOptions)),e.append("x-goog-api-key",t.apiKey);let s=(n=t.requestOptions)===null||n===void 0?void 0:n.customHeaders;if(s){if(!(s instanceof Headers))try{s=new Headers(s)}catch(i){throw new E(`unable to convert customHeaders value ${JSON.stringify(s)} to Headers: ${i.message}`)}for(let[i,o]of s.entries()){if(i==="x-goog-api-key")throw new E(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new E(`Header name ${i} can only be set using the apiClient field`);e.append(i,o)}}return e}async function _t(t,n,e,s,i,o){let a=new G(t,n,e,s,o);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},At(o)),{method:"POST",headers:await Ct(a),body:i})}}async function S(t,n,e,s,i,o={},a=fetch){let{url:r,fetchOptions:c}=await _t(t,n,e,s,i,o);return pt(r,c,a)}async function pt(t,n,e=fetch){let s;try{s=await e(t,n)}catch(i){It(i,t)}return s.ok||await mt(s,t),s}function It(t,n){let e=t;throw e.name==="AbortError"?(e=new b(`Request aborted when fetching ${n.toString()}: ${t.message}`),e.stack=t.stack):t instanceof N||t instanceof E||(e=new u(`Error fetching from ${n.toString()}: ${t.message}`),e.stack=t.stack),e}async function mt(t,n){let e="",s;try{let i=await t.json();e=i.error.message,i.error.details&&(e+=` ${JSON.stringify(i.error.details)}`,s=i.error.details)}catch(i){}throw new N(`Error fetching from ${n.toString()}: [${t.status} ${t.statusText}] ${e}`,t.status,t.statusText,s)}function At(t){let n={};if((t==null?void 0:t.signal)!==void 0||(t==null?void 0:t.timeout)>=0){let e=new AbortController;(t==null?void 0:t.timeout)>=0&&setTimeout(()=>e.abort(),t.timeout),t!=null&&t.signal&&t.signal.addEventListener("abort",()=>{e.abort()}),n.signal=e.signal}return n}function H(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),T(t.candidates[0]))throw new C(`${_(t)}`,t);return Ot(t)}else if(t.promptFeedback)throw new C(`Text not available. ${_(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),T(t.candidates[0]))throw new C(`${_(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),X(t)[0]}else if(t.promptFeedback)throw new C(`Function call not available. ${_(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),T(t.candidates[0]))throw new C(`${_(t)}`,t);return X(t)}else if(t.promptFeedback)throw new C(`Function call not available. ${_(t)}`,t)},t}function Ot(t){var n,e,s,i;let o=[];if(!((e=(n=t.candidates)===null||n===void 0?void 0:n[0].content)===null||e===void 0)&&e.parts)for(let a of(i=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)a.text&&o.push(a.text),a.executableCode&&o.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&o.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return o.length>0?o.join(""):""}function X(t){var n,e,s,i;let o=[];if(!((e=(n=t.candidates)===null||n===void 0?void 0:n[0].content)===null||e===void 0)&&e.parts)for(let a of(i=(s=t.candidates)===null||s===void 0?void 0:s[0].content)===null||i===void 0?void 0:i.parts)a.functionCall&&o.push(a.functionCall);if(o.length>0)return o}var yt=[R.RECITATION,R.SAFETY,R.LANGUAGE];function T(t){return!!t.finishReason&&yt.includes(t.finishReason)}function _(t){var n,e,s;let i="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)i+="Response was blocked",!((n=t.promptFeedback)===null||n===void 0)&&n.blockReason&&(i+=` due to ${t.promptFeedback.blockReason}`),!((e=t.promptFeedback)===null||e===void 0)&&e.blockReasonMessage&&(i+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((s=t.candidates)===null||s===void 0)&&s[0]){let o=t.candidates[0];T(o)&&(i+=`Candidate was blocked due to ${o.finishReason}`,o.finishMessage&&(i+=`: ${o.finishMessage}`))}return i}function v(t){return this instanceof v?(this.v=t,this):new v(t)}function Rt(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=e.apply(t,n||[]),i,o=[];return i={},a("next"),a("throw"),a("return"),i[Symbol.asyncIterator]=function(){return this},i;function a(l){s[l]&&(i[l]=function(d){return new Promise(function(h,y){o.push([l,d,h,y])>1||r(l,d)})})}function r(l,d){try{c(s[l](d))}catch(h){O(o[0][3],h)}}function c(l){l.value instanceof v?Promise.resolve(l.value.v).then(g,A):O(o[0][2],l)}function g(l){r("next",l)}function A(l){r("throw",l)}function O(l,d){l(d),o.shift(),o.length&&r(o[0][0],o[0][1])}}var W=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function vt(t){let n=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),e=Tt(n),[s,i]=e.tee();return{stream:St(s),response:wt(i)}}async function wt(t){let n=[],e=t.getReader();for(;;){let{done:s,value:i}=await e.read();if(s)return H(Nt(n));n.push(i)}}function St(t){return Rt(this,arguments,function*(){let e=t.getReader();for(;;){let{value:s,done:i}=yield v(e.read());if(i)break;yield yield v(H(s))}})}function Tt(t){let n=t.getReader();return new ReadableStream({start(s){let i="";return o();function o(){return n.read().then(({value:a,done:r})=>{if(r){if(i.trim()){s.error(new u("Failed to parse stream"));return}s.close();return}i+=a;let c=i.match(W),g;for(;c;){try{g=JSON.parse(c[1])}catch(A){s.error(new u(`Error parsing JSON response: "${c[1]}"`));return}s.enqueue(g),i=i.substring(c[0].length),c=i.match(W)}return o()}).catch(a=>{let r=a;throw r.stack=a.stack,r.name==="AbortError"?r=new b("Request aborted when reading from the stream"):r=new u("Error reading from the stream"),r})}}})}function Nt(t){let n=t[t.length-1],e={promptFeedback:n==null?void 0:n.promptFeedback};for(let s of t){if(s.candidates){let i=0;for(let o of s.candidates)if(e.candidates||(e.candidates=[]),e.candidates[i]||(e.candidates[i]={index:i}),e.candidates[i].citationMetadata=o.citationMetadata,e.candidates[i].groundingMetadata=o.groundingMetadata,e.candidates[i].finishReason=o.finishReason,e.candidates[i].finishMessage=o.finishMessage,e.candidates[i].safetyRatings=o.safetyRatings,o.content&&o.content.parts){e.candidates[i].content||(e.candidates[i].content={role:o.content.role||"user",parts:[]});let a={};for(let r of o.content.parts)r.text&&(a.text=r.text),r.functionCall&&(a.functionCall=r.functionCall),r.executableCode&&(a.executableCode=r.executableCode),r.codeExecutionResult&&(a.codeExecutionResult=r.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),e.candidates[i].content.parts.push(a)}i++}s.usageMetadata&&(e.usageMetadata=s.usageMetadata)}return e}async function et(t,n,e,s){let i=await S(n,m.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(e),s);return vt(i)}async function nt(t,n,e,s){let o=await(await S(n,m.GENERATE_CONTENT,t,!1,JSON.stringify(e),s)).json();return{response:H(o)}}function st(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function w(t){let n=[];if(typeof t=="string")n=[{text:t}];else for(let e of t)typeof e=="string"?n.push({text:e}):n.push(e);return bt(n)}function bt(t){let n={role:"user",parts:[]},e={role:"function",parts:[]},s=!1,i=!1;for(let o of t)"functionResponse"in o?(e.parts.push(o),i=!0):(n.parts.push(o),s=!0);if(s&&i)throw new u("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!s&&!i)throw new u("No content is provided for sending chat message.");return s?n:e}function Mt(t,n){var e;let s={model:n==null?void 0:n.model,generationConfig:n==null?void 0:n.generationConfig,safetySettings:n==null?void 0:n.safetySettings,tools:n==null?void 0:n.tools,toolConfig:n==null?void 0:n.toolConfig,systemInstruction:n==null?void 0:n.systemInstruction,cachedContent:(e=n==null?void 0:n.cachedContent)===null||e===void 0?void 0:e.name,contents:[]},i=t.generateContentRequest!=null;if(t.contents){if(i)throw new E("CountTokensRequest must have one of contents or generateContentRequest, not both.");s.contents=t.contents}else if(i)s=Object.assign(Object.assign({},s),t.generateContentRequest);else{let o=w(t);s.contents=[o]}return{generateContentRequest:s}}function z(t){let n;return t.contents?n=t:n={contents:[w(t)]},t.systemInstruction&&(n.systemInstruction=st(t.systemInstruction)),n}function xt(t){return typeof t=="string"||Array.isArray(t)?{content:w(t)}:t}var Q=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],Dt={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function Lt(t){let n=!1;for(let e of t){let{role:s,parts:i}=e;if(!n&&s!=="user")throw new u(`First content should be with role 'user', got ${s}`);if(!Y.includes(s))throw new u(`Each item should include role field. Got ${s} but valid roles are: ${JSON.stringify(Y)}`);if(!Array.isArray(i))throw new u("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new u("Each Content should have at least one part");let o={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let r of i)for(let c of Q)c in r&&(o[c]+=1);let a=Dt[s];for(let r of Q)if(!a.includes(r)&&o[r]>0)throw new u(`Content with role '${s}' can't contain '${r}' part`);n=!0}}function Z(t){var n;if(t.candidates===void 0||t.candidates.length===0)return!1;let e=(n=t.candidates[0])===null||n===void 0?void 0:n.content;if(e===void 0||e.parts===void 0||e.parts.length===0)return!1;for(let s of e.parts)if(s===void 0||Object.keys(s).length===0||s.text!==void 0&&s.text==="")return!1;return!0}var tt="SILENT_ERROR",U=class{constructor(n,e,s,i={}){this.model=e,this.params=s,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=n,s!=null&&s.history&&(Lt(s.history),this._history=s.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(n,e={}){var s,i,o,a,r,c;await this._sendPromise;let g=w(n),A={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,g]},O=Object.assign(Object.assign({},this._requestOptions),e),l;return this._sendPromise=this._sendPromise.then(()=>nt(this._apiKey,this.model,A,O)).then(d=>{var h;if(Z(d.response)){this._history.push(g);let y=Object.assign({parts:[],role:"model"},(h=d.response.candidates)===null||h===void 0?void 0:h[0].content);this._history.push(y)}else{let y=_(d.response);y&&console.warn(`sendMessage() was unsuccessful. ${y}. Inspect response object for details.`)}l=d}),await this._sendPromise,l}async sendMessageStream(n,e={}){var s,i,o,a,r,c;await this._sendPromise;let g=w(n),A={safetySettings:(s=this.params)===null||s===void 0?void 0:s.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(o=this.params)===null||o===void 0?void 0:o.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(r=this.params)===null||r===void 0?void 0:r.systemInstruction,cachedContent:(c=this.params)===null||c===void 0?void 0:c.cachedContent,contents:[...this._history,g]},O=Object.assign(Object.assign({},this._requestOptions),e),l=et(this._apiKey,this.model,A,O);return this._sendPromise=this._sendPromise.then(()=>l).catch(d=>{throw new Error(tt)}).then(d=>d.response).then(d=>{if(Z(d)){this._history.push(g);let h=Object.assign({},d.candidates[0].content);h.role||(h.role="model"),this._history.push(h)}else{let h=_(d);h&&console.warn(`sendMessageStream() was unsuccessful. ${h}. Inspect response object for details.`)}}).catch(d=>{d.message!==tt&&console.error(d)}),l}};async function Gt(t,n,e,s){return(await S(n,m.COUNT_TOKENS,t,!1,JSON.stringify(e),s)).json()}async function Ut(t,n,e,s){return(await S(n,m.EMBED_CONTENT,t,!1,JSON.stringify(e),s)).json()}async function Ht(t,n,e,s){let i=e.requests.map(a=>Object.assign(Object.assign({},a),{model:n}));return(await S(n,m.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:i}),s)).json()}var M=class{constructor(n,e,s={}){this.apiKey=n,this._requestOptions=s,e.model.includes("/")?this.model=e.model:this.model=`models/${e.model}`,this.generationConfig=e.generationConfig||{},this.safetySettings=e.safetySettings||[],this.tools=e.tools,this.toolConfig=e.toolConfig,this.systemInstruction=st(e.systemInstruction),this.cachedContent=e.cachedContent}async generateContent(n,e={}){var s;let i=z(n),o=Object.assign(Object.assign({},this._requestOptions),e);return nt(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),o)}async generateContentStream(n,e={}){var s;let i=z(n),o=Object.assign(Object.assign({},this._requestOptions),e);return et(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(s=this.cachedContent)===null||s===void 0?void 0:s.name},i),o)}startChat(n){var e;return new U(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(e=this.cachedContent)===null||e===void 0?void 0:e.name},n),this._requestOptions)}async countTokens(n,e={}){let s=Mt(n,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),e);return Gt(this.apiKey,this.model,s,i)}async embedContent(n,e={}){let s=xt(n),i=Object.assign(Object.assign({},this._requestOptions),e);return Ut(this.apiKey,this.model,s,i)}async batchEmbedContents(n,e={}){let s=Object.assign(Object.assign({},this._requestOptions),e);return Ht(this.apiKey,this.model,n,s)}};var x=class{constructor(n){this.apiKey=n}getGenerativeModel(n,e){if(!n.model)throw new u("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new M(this.apiKey,n,e)}getGenerativeModelFromCachedContent(n,e,s){if(!n.name)throw new E("Cached content must contain a `name` field.");if(!n.model)throw new E("Cached content must contain a `model` field.");let i=["model","systemInstruction"];for(let a of i)if(e!=null&&e[a]&&n[a]&&(e==null?void 0:e[a])!==n[a]){if(a==="model"){let r=e.model.startsWith("models/")?e.model.replace("models/",""):e.model,c=n.model.startsWith("models/")?n.model.replace("models/",""):n.model;if(r===c)continue}throw new E(`Different value for "${a}" specified in modelParams (${e[a]}) and cachedContent (${n[a]})`)}let o=Object.assign(Object.assign({},e),{model:n.model,tools:n.tools,toolConfig:n.toolConfig,systemInstruction:n.systemInstruction,cachedContent:n});return new M(this.apiKey,o,s)}};var it={apiKey:"",modelName:"gemini-1.5-flash"},D=class extends f.Plugin{constructor(){super(...arguments);this.genAI=null}async onload(){await this.loadSettings(),this.updateGenAIClient(),this.addCommand({id:"ai-rewrite-selection",name:"Rewrite selection with AI",editorCallback:(e,s)=>{let i=e.getSelection();i&&this.genAI?new k(this.app,i,this.genAI,this.settings.modelName,o=>{e.replaceSelection(o)}).open():this.genAI?new f.Notice("Please select text to rewrite."):new f.Notice("Please configure the Google AI API Key in the plugin settings.")}}),this.addSettingTab(new F(this.app,this)),console.log("AI Rewriter plugin loaded.")}onunload(){console.log("AI Rewriter plugin unloaded.")}async loadSettings(){this.settings=Object.assign({},it,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.updateGenAIClient()}updateGenAIClient(){if(this.settings.apiKey)try{this.genAI=new x(this.settings.apiKey)}catch(e){console.error("Error initializing GoogleGenerativeAI:",e),new f.Notice("Failed to initialize Google AI Client. Check your API key."),this.genAI=null}else this.genAI=null}},k=class extends f.Modal{constructor(e,s,i,o,a){super(e);this.selectedText=s,this.genAI=i,this.modelName=o,this.onSubmit=a}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"AI Rewriter Instructions"}),new f.Setting(e).setName("Instructions").setDesc("Enter how you want the AI to rewrite the selected text:").addTextArea(s=>{s.setPlaceholder("e.g., Make this more concise, Fix grammar and spelling, Change the tone to formal").onChange(i=>{this.instructionInput.value=i}),s.inputEl.rows=5,s.inputEl.style.width="100%",this.instructionInput=s.inputEl}),new f.Setting(e).addButton(s=>s.setButtonText("Rewrite").setCta().onClick(async()=>{let i=this.instructionInput.value.trim();i?(this.showLoading(),await this.callGeminiAPI(i)):new f.Notice("Please enter instructions.")}))}showLoading(){let{contentEl:e}=this;e.empty(),e.createEl("h3",{text:"Rewriting..."});let s=e.createDiv({cls:"loading-spinner"})}async callGeminiAPI(e){let s=`You are an AI assistant integrated into the Obsidian editor. Your task is to rewrite the user's selected text based on their instructions.
		You MUST follow these rules:
		1.  STRICTLY output ONLY the rewritten text based on the provided selection and instructions.
		2.  DO NOT include any greetings, explanations, apologies, or conversational filler in your response.
		3.  DO NOT use markdown formatting unless the rewritten text itself requires it (e.g., preserving code blocks, lists).
		4.  The output must be suitable for direct replacement of the original selected text in the editor.
		5.  If the instructions are unclear or impossible for the given text, output the original text unchanged.

		User's selected text:
		---
		${this.selectedText}
		---

		User's instructions for rewriting:
		---
		${e}
		---

		Rewritten text:`;try{let i=this.genAI.getGenerativeModel({model:this.modelName,systemInstruction:s,safetySettings:[{category:p.HARM_CATEGORY_HARASSMENT,threshold:I.BLOCK_MEDIUM_AND_ABOVE},{category:p.HARM_CATEGORY_HATE_SPEECH,threshold:I.BLOCK_MEDIUM_AND_ABOVE},{category:p.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:I.BLOCK_MEDIUM_AND_ABOVE},{category:p.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:I.BLOCK_MEDIUM_AND_ABOVE}]}),o="",c=(await(await i.generateContent(o)).response).text();this.onSubmit(c),this.close()}catch(i){console.error("Error calling Google Gemini API:",i),new f.Notice(`Error rewriting text: ${i.message}`),this.contentEl.empty(),this.contentEl.createEl("h3",{text:"Error"}),this.contentEl.createEl("p",{text:`Failed to rewrite text. ${i.message}`});let o=this.contentEl.createEl("button",{text:"Close"});o.onclick=()=>this.close()}}onClose(){let{contentEl:e}=this;e.empty()}},F=class extends f.PluginSettingTab{constructor(e,s){super(e,s);this.plugin=s}display(){let{containerEl:e}=this;e.empty(),e.createEl("h2",{text:"AI Rewriter Settings"}),new f.Setting(e).setName("Google AI API Key").setDesc("Enter your API key for Google Generative AI (Gemini).").addText(s=>s.setPlaceholder("Enter your API key").setValue(this.plugin.settings.apiKey).onChange(async i=>{this.plugin.settings.apiKey=i.trim(),await this.plugin.saveSettings()})),new f.Setting(e).setName("Google AI Model Name").setDesc("Enter the name of the Gemini model to use (e.g., gemini-1.5-flash, gemini-1.5-pro-latest). Ensure the model is available for your API key.").addText(s=>s.setPlaceholder("gemini-1.5-flash").setValue(this.plugin.settings.modelName).onChange(async i=>{this.plugin.settings.modelName=i.trim()||it.modelName,await this.plugin.saveSettings()})),e.createEl("p",{text:"Remember to reload Obsidian after changing settings for them to take full effect."})}};
/*! Bundled license information:

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)

@google/generative-ai/dist/index.mjs:
  (**
   * @license
   * Copyright 2024 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *)
*/
